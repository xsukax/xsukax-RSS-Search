<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>xsukax RSS Search</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #000; color: #0f0; font: 14px 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; line-height: 1.4; }
.terminal { min-height: 100vh; padding: 20px; background: radial-gradient(ellipse at center, #001100 0%, #000000 100%); }
.header { border-bottom: 1px solid #0f0; padding-bottom: 15px; margin-bottom: 20px; text-align: center; }
.title { color: #0f0; font-size: 22px; font-weight: bold; text-shadow: 0 0 10px #0f0; }
.subtitle { color: #008800; font-size: 12px; margin-top: 8px; }
.connection-bar { background: rgba(0, 255, 0, 0.05); border: 1px solid #003300; padding: 12px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border-radius: 3px; }
.status-dot { width: 12px; height: 12px; border-radius: 50%; background: #f00; transition: all 0.3s; }
.status-dot.connected { background: #0f0; box-shadow: 0 0 10px #0f0; }
.connection-info { flex: 1; font-size: 12px; }
.section { margin-bottom: 25px; border: 1px solid #003300; padding: 18px; background: rgba(0, 255, 0, 0.02); border-radius: 3px; }
.section-title { color: #00ff00; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; font-size: 13px; border-bottom: 1px dotted #006600; padding-bottom: 5px; }
.form-group { margin-bottom: 15px; }
.label { display: block; color: #00cc00; margin-bottom: 6px; font-size: 11px; text-transform: uppercase; }
.input, .select, .textarea { width: 100%; padding: 10px; background: #001100; border: 1px solid #006600; color: #0f0; font-family: inherit; font-size: 13px; border-radius: 2px; transition: all 0.2s; }
.input:focus, .select:focus, .textarea:focus { outline: none; border-color: #00ff00; box-shadow: 0 0 5px rgba(0, 255, 0, 0.3); }
.textarea { min-height: 70px; resize: vertical; }
.btn { padding: 10px 18px; background: #002200; border: 1px solid #00ff00; color: #0f0; font-family: inherit; cursor: pointer; font-size: 12px; text-transform: uppercase; border-radius: 2px; transition: all 0.2s; }
.btn:hover { background: #004400; box-shadow: 0 0 8px rgba(0, 255, 0, 0.4); }
.btn:active { background: #001100; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-danger { border-color: #ff0000; color: #ff4444; }
.btn-danger:hover { background: #440000; box-shadow: 0 0 8px rgba(255, 0, 0, 0.4); }
.btn-small { padding: 6px 12px; font-size: 10px; }
.btn-group { display: flex; gap: 10px; }
.feeds-container { max-height: 220px; overflow-y: auto; border: 1px solid #006600; background: #001100; border-radius: 2px; }
.feed-item { padding: 12px; border-bottom: 1px solid #003300; display: flex; justify-content: space-between; align-items: center; }
.feed-item:last-child { border-bottom: none; }
.feed-url { color: #00aa00; font-size: 11px; flex: 1; word-break: break-all; margin-right: 10px; }
.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
.search-controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 15px; }

/* Popup notification styles */
.popup-notification {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 2000;
  max-width: 350px;
  min-width: 250px;
  padding: 15px 20px;
  border-radius: 5px;
  font-size: 12px;
  border: 1px solid;
  background: rgba(0, 0, 0, 0.95);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
  transform: translateX(100%);
  opacity: 0;
  transition: all 0.3s ease-in-out;
  border-left: 4px solid;
  word-wrap: break-word;
}
.popup-notification.show {
  transform: translateX(0);
  opacity: 1;
}
.popup-notification.error {
  border-color: #ff0000;
  color: #ff4444;
  background: rgba(30, 0, 0, 0.95);
  border-left-color: #ff0000;
}
.popup-notification.success {
  border-color: #00ff00;
  color: #00ff00;
  background: rgba(0, 30, 0, 0.95);
  border-left-color: #00ff00;
}
.popup-notification.info {
  border-color: #ffff00;
  color: #ffff00;
  background: rgba(30, 30, 0, 0.95);
  border-left-color: #ffff00;
}
.popup-close {
  position: absolute;
  top: 8px;
  right: 12px;
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  opacity: 0.7;
  transition: opacity 0.2s;
}
.popup-close:hover {
  opacity: 1;
}

.results-section { margin-top: 20px; }
.result-item { border: 1px solid #004400; margin-bottom: 12px; padding: 15px; background: rgba(0, 255, 0, 0.03); border-radius: 3px; }
.result-title { margin-bottom: 8px; }
.result-title a { color: #00ff00; text-decoration: none; font-weight: bold; }
.result-title a:hover { text-decoration: underline; text-shadow: 0 0 5px #0f0; }
.result-meta { color: #008800; font-size: 11px; margin-bottom: 8px; }
.result-summary { color: #00aa00; font-size: 12px; line-height: 1.4; }
.results-stats { display: flex; gap: 15px; margin-bottom: 15px; font-size: 11px; color: #008800; }
.stat-item { border: 1px solid #004400; padding: 6px 12px; background: rgba(0, 255, 0, 0.02); border-radius: 2px; }
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); }
.modal-content { background: #001100; margin: 8% auto; padding: 25px; border: 2px solid #00ff00; width: 450px; max-width: 90%; border-radius: 5px; box-shadow: 0 0 20px rgba(0, 255, 0, 0.3); }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #006600; padding-bottom: 10px; }
.modal-title { color: #00ff00; font-weight: bold; text-transform: uppercase; font-size: 14px; }
.close { color: #ff4444; font-size: 24px; cursor: pointer; background: none; border: none; transition: all 0.2s; }
.close:hover { color: #ff0000; text-shadow: 0 0 10px #ff0000; }
.modal-footer { margin-top: 20px; text-align: right; }
/* Modal status styles */
.modal-status { padding: 10px; margin: 10px 0; border-left: 4px solid; font-size: 11px; border-radius: 2px; display: none; }
.modal-status.error { border-color: #ff0000; color: #ff4444; background: rgba(255, 0, 0, 0.1); }
.modal-status.success { border-color: #00ff00; color: #00ff00; background: rgba(0, 255, 0, 0.1); }
.modal-status.info { border-color: #ffff00; color: #ffff00; background: rgba(255, 255, 0, 0.1); }
@media (max-width: 768px) { 
  .grid { grid-template-columns: 1fr; } 
  .search-controls { grid-template-columns: 1fr; } 
  .btn-group { flex-direction: column; } 
  .results-stats { flex-direction: column; gap: 8px; } 
  .connection-bar { flex-direction: column; align-items: flex-start; gap: 8px; }
  .popup-notification { right: 10px; top: 10px; max-width: calc(100vw - 20px); }
}
</style>
</head>
<body>
<div class="terminal">
  <div class="header">
    <div class="title">▶ xsukax RSS Search</div>
    <div class="subtitle">Advanced RSS Feed Search & Management System</div>
  </div>
  
  <div class="connection-bar">
    <div class="status-dot" id="statusDot"></div>
    <div class="connection-info">
      <div>Status: <span id="statusText">Disconnected</span></div>
      <div style="font-size: 10px; color: #666; margin-top: 2px;" id="apiUrlDisplay">No connection</div>
    </div>
    <button onclick="showConnectionModal()" class="btn btn-small">Connect</button>
  </div>
  
  <div id="mainContent" style="display: none;">
    <div class="grid">
      <div class="section">
        <div class="section-title">Feed Management</div>
        <div class="form-group">
          <label class="label">RSS Feed URL:</label>
          <input type="url" id="newFeedUrl" class="input" placeholder="https://example.com/rss.xml">
        </div>
        <div class="btn-group">
          <button onclick="validateFeed()" class="btn" style="flex: 1;">Validate Feed</button>
          <button onclick="addFeed()" class="btn" style="flex: 1;">Add Feed</button>
        </div>
        <div class="form-group" style="margin-top: 20px;">
          <label class="label">Current Feeds:</label>
          <div id="feedsList" class="feeds-container">
            <div style="padding: 15px; color: #666; text-align: center;">Connect to API to view feeds</div>
          </div>
        </div>
        <button onclick="loadFeeds()" class="btn" style="width: 100%; margin-top: 10px;">Refresh Feeds</button>
      </div>
      
      <div class="section">
        <div class="section-title">Search Configuration</div>
        <div class="form-group">
          <label class="label">Keywords (comma-separated):</label>
          <textarea id="keywords" class="textarea" placeholder="technology, AI, news, science"></textarea>
        </div>
        <div class="search-controls">
          <div class="form-group">
            <label class="label">Search In:</label>
            <select id="searchField" class="select">
              <option value="both">Title & Description</option>
              <option value="title">Title Only</option>
              <option value="description">Description Only</option>
            </select>
          </div>
          <div class="form-group">
            <label class="label">Match Mode:</label>
            <select id="matchMode" class="select">
              <option value="any">Any Keyword</option>
              <option value="all">All Keywords</option>
            </select>
          </div>
          <div class="form-group">
            <label class="label">Max Results:</label>
            <input type="number" id="maxResults" class="input" value="50" min="1" max="500">
          </div>
        </div>
        <button onclick="searchFeeds()" class="btn" style="width: 100%; margin-top: 15px;">Execute Search</button>
      </div>
    </div>
    
    <div id="searchResults" class="results-section" style="display: none;">
      <div class="section">
        <div class="section-title">Search Results</div>
        <div id="resultsStats" class="results-stats"></div>
        <div id="resultsList"></div>
      </div>
    </div>
  </div>
</div>

<!-- Connection Modal -->
<div id="connectionModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">API Connection Settings</div>
      <button class="close" onclick="hideConnectionModal()">&times;</button>
    </div>
    <div class="form-group">
      <label class="label">API Server URL:</label>
      <input type="text" id="apiUrlInput" class="input" value="http://localhost:8000" placeholder="http://localhost:8000">
    </div>
    <div style="font-size: 11px; color: #888; margin-bottom: 15px;">
      Examples:<br>
      • Local: http://localhost:8000<br>
      • Remote: http://your-server.com:8000<br>
      • Custom: http://192.168.1.100:9000
    </div>
    <div id="modalStatus" class="modal-status"></div>
    <div class="modal-footer">
      <button onclick="testConnection()" class="btn" style="margin-right: 10px;">Test</button>
      <button onclick="connectToAPI()" class="btn">Connect</button>
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div id="confirmModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Confirm Action</div>
      <button class="close" onclick="hideConfirmModal()">&times;</button>
    </div>
    <div style="margin-bottom: 20px;">
      <p id="confirmMessage">Are you sure you want to proceed?</p>
    </div>
    <div class="modal-footer">
      <button onclick="hideConfirmModal()" class="btn" style="margin-right: 10px;">Cancel</button>
      <button onclick="executeConfirmAction()" class="btn btn-danger">Confirm</button>
    </div>
  </div>
</div>

<script>
let API_BASE = '', isConnected = false, confirmCallback = null;

// Modal functions
function showConnectionModal() { 
  document.getElementById('connectionModal').style.display = 'block'; 
  hideModalStatus();
}

function hideConnectionModal() { 
  document.getElementById('connectionModal').style.display = 'none'; 
  hideModalStatus();
}

function showConfirmModal(message, callback) { 
  document.getElementById('confirmMessage').textContent = message; 
  confirmCallback = callback; 
  document.getElementById('confirmModal').style.display = 'block'; 
}

function hideConfirmModal() { 
  document.getElementById('confirmModal').style.display = 'none'; 
  confirmCallback = null; 
}

function executeConfirmAction() { 
  if (confirmCallback) confirmCallback(); 
  hideConfirmModal(); 
}

// Modal status functions
function showModalStatus(message, type = 'error') { 
  const modalStatusEl = document.getElementById('modalStatus'); 
  modalStatusEl.className = `modal-status ${type}`; 
  modalStatusEl.innerHTML = message; 
  modalStatusEl.style.display = 'block'; 
  if (type === 'success') setTimeout(() => hideModalStatus(), 3000); 
}

function hideModalStatus() { 
  const modalStatusEl = document.getElementById('modalStatus');
  modalStatusEl.style.display = 'none'; 
}

// Popup notification functions
function showPopupNotification(message, type = 'error', duration = 5000) {
  // Remove any existing popup
  const existingPopup = document.querySelector('.popup-notification');
  if (existingPopup) {
    existingPopup.remove();
  }
  
  // Create new popup
  const popup = document.createElement('div');
  popup.className = `popup-notification ${type}`;
  popup.innerHTML = `
    <button class="popup-close" onclick="this.parentElement.remove()">&times;</button>
    ${message}
  `;
  
  document.body.appendChild(popup);
  
  // Trigger animation
  setTimeout(() => popup.classList.add('show'), 10);
  
  // Auto remove
  if (duration > 0) {
    setTimeout(() => {
      if (popup.parentElement) {
        popup.classList.remove('show');
        setTimeout(() => popup.remove(), 300);
      }
    }, duration);
  }
}

// Connection status
function updateConnectionStatus() { 
  const dot = document.getElementById('statusDot');
  const text = document.getElementById('statusText');
  const url = document.getElementById('apiUrlDisplay'); 
  
  if (isConnected) { 
    dot.classList.add('connected'); 
    text.textContent = 'Connected'; 
    url.textContent = API_BASE; 
  } else { 
    dot.classList.remove('connected'); 
    text.textContent = 'Disconnected'; 
    url.textContent = 'No connection'; 
  } 
}

// API functions
async function testConnection() { 
  const url = document.getElementById('apiUrlInput').value.trim(); 
  if (!url) { 
    showModalStatus('Please enter a valid URL'); 
    return; 
  } 
  
  showModalStatus('Testing connection...', 'info'); 
  
  try { 
    const response = await fetch(`${url}/health`, { method: 'GET' }); 
    if (response.ok) { 
      const data = await response.json(); 
      showModalStatus(`✓ Connection test successful! Server status: ${data.status}`, 'success'); 
    } else { 
      showModalStatus('Connection test failed - Server error'); 
    } 
  } catch (error) { 
    showModalStatus(`Connection test failed: ${error.message}`); 
  } 
}

async function connectToAPI() { 
  const url = document.getElementById('apiUrlInput').value.trim(); 
  if (!url) { 
    showModalStatus('Please enter a valid URL'); 
    return; 
  } 
  
  showModalStatus('Connecting...', 'info');
  
  try { 
    const response = await fetch(`${url}/health`); 
    if (!response.ok) throw new Error('Health check failed'); 
    
    API_BASE = url; 
    isConnected = true; 
    updateConnectionStatus(); 
    showModalStatus('✓ Successfully connected to API!', 'success');
    
    setTimeout(() => {
      hideConnectionModal(); 
      showPopupNotification('Successfully connected to API!', 'success', 3000); 
      document.getElementById('mainContent').style.display = 'block'; 
      loadFeeds(); 
    }, 1500);
  } catch (error) { 
    showModalStatus(`Connection failed: ${error.message}`); 
  } 
}

async function validateFeed() { 
  if (!isConnected) { 
    showPopupNotification('Please connect to API first'); 
    return; 
  } 
  
  const url = document.getElementById('newFeedUrl').value.trim(); 
  if (!url) { 
    showPopupNotification('Please enter a feed URL'); 
    return; 
  } 
  
  showPopupNotification('Validating feed...', 'info', 0); 
  
  try { 
    const response = await fetch(`${API_BASE}/validate`, { 
      method: 'POST', 
      headers: { 'Content-Type': 'application/json' }, 
      body: JSON.stringify({ url }) 
    }); 
    
    const data = await response.json(); 
    
    if (response.ok) { 
      const title = data.title || 'Untitled Feed';
      const count = data.entry_count || 0; 
      showPopupNotification(`✓ Valid feed: "${title}" (${count} entries)`, 'success', 4000); 
    } else { 
      showPopupNotification(`Validation failed: ${data.detail}`); 
    } 
  } catch (error) { 
    showPopupNotification(`Validation error: ${error.message}`); 
  } 
}

async function loadFeeds() { 
  if (!isConnected) { 
    showPopupNotification('Please connect to API first'); 
    return; 
  } 
  
  const feedsList = document.getElementById('feedsList'); 
  feedsList.innerHTML = '<div style="padding: 15px; color: #666; text-align: center;">Loading feeds...</div>'; 
  
  try { 
    const response = await fetch(`${API_BASE}/feeds`);
    const data = await response.json(); 
    
    if (data.feeds.length === 0) { 
      feedsList.innerHTML = '<div style="padding: 15px; color: #666; text-align: center;">No feeds configured</div>'; 
      return; 
    } 
    
    feedsList.innerHTML = data.feeds.map(feed => 
      `<div class="feed-item">
        <div class="feed-url">${escapeHtml(feed.url)}</div>
        <button onclick="confirmDeleteFeed(${feed.id}, '${escapeHtml(feed.url)}')" class="btn btn-danger btn-small">Delete</button>
      </div>`
    ).join(''); 
  } catch (error) { 
    feedsList.innerHTML = '<div style="padding: 15px; color: #ff4444; text-align: center;">Failed to load feeds</div>'; 
    showPopupNotification(`Error loading feeds: ${error.message}`); 
  } 
}

async function addFeed() { 
  if (!isConnected) { 
    showPopupNotification('Please connect to API first'); 
    return; 
  } 
  
  const url = document.getElementById('newFeedUrl').value.trim(); 
  if (!url) { 
    showPopupNotification('Please enter a feed URL'); 
    return; 
  } 
  
  try { 
    const response = await fetch(`${API_BASE}/feeds`, { 
      method: 'POST', 
      headers: { 'Content-Type': 'application/json' }, 
      body: JSON.stringify({ url }) 
    }); 
    
    if (response.ok) { 
      document.getElementById('newFeedUrl').value = ''; 
      showPopupNotification('Feed added successfully!', 'success', 3000); 
      loadFeeds(); 
    } else { 
      const error = await response.json(); 
      showPopupNotification(`Failed to add feed: ${error.detail}`); 
    } 
  } catch (error) { 
    showPopupNotification(`Error adding feed: ${error.message}`); 
  } 
}

function confirmDeleteFeed(feedId, feedUrl) { 
  showConfirmModal(`Delete feed: ${feedUrl}?`, () => deleteFeed(feedId)); 
}

async function deleteFeed(feedId) { 
  try { 
    const response = await fetch(`${API_BASE}/feeds/${feedId}`, { method: 'DELETE' }); 
    
    if (response.ok) { 
      showPopupNotification('Feed deleted successfully!', 'success', 3000); 
      loadFeeds(); 
    } else { 
      const error = await response.json(); 
      showPopupNotification(`Failed to delete feed: ${error.detail}`); 
    } 
  } catch (error) { 
    showPopupNotification(`Error deleting feed: ${error.message}`); 
  } 
}

async function searchFeeds() { 
  if (!isConnected) { 
    showPopupNotification('Please connect to API first'); 
    return; 
  } 
  
  const keywords = document.getElementById('keywords').value.trim(); 
  if (!keywords) { 
    showPopupNotification('Please enter search keywords'); 
    return; 
  } 
  
  showPopupNotification('Searching feeds...', 'info', 0); 
  
  try { 
    const response = await fetch(`${API_BASE}/search`, { 
      method: 'POST', 
      headers: { 'Content-Type': 'application/json' }, 
      body: JSON.stringify({ 
        keywords, 
        field: document.getElementById('searchField').value, 
        mode: document.getElementById('matchMode').value, 
        max_results: parseInt(document.getElementById('maxResults').value) || 0 
      }) 
    }); 
    
    if (response.ok) { 
      const data = await response.json(); 
      displaySearchResults(data); 
      // Remove the searching notification
      const existingPopup = document.querySelector('.popup-notification');
      if (existingPopup) existingPopup.remove();
    } else { 
      const error = await response.json(); 
      showPopupNotification(`Search failed: ${error.detail}`); 
    } 
  } catch (error) { 
    showPopupNotification(`Search error: ${error.message}`); 
  } 
}

function displaySearchResults(data) { 
  const resultsSection = document.getElementById('searchResults');
  const statsEl = document.getElementById('resultsStats');
  const listEl = document.getElementById('resultsList'); 
  
  statsEl.innerHTML = `
    <div class="stat-item">Results: ${data.results.length}</div>
    <div class="stat-item">Total Feeds: ${data.total_feeds}</div>
    <div class="stat-item">Failed: ${data.failed_feeds.length}</div>
    <div class="stat-item">Mode: ${data.search_params.mode}</div>
    <div class="stat-item">Field: ${data.search_params.field}</div>
  `; 
  
  if (data.results.length === 0) { 
    listEl.innerHTML = '<div style="padding: 20px; color: #666; text-align: center;">No results found. Try different keywords or search settings.</div>'; 
  } else { 
    listEl.innerHTML = data.results.map(result => 
      `<div class="result-item">
        <div class="result-title">
          <a href="${escapeHtml(result.link)}" target="_blank" rel="noopener">${escapeHtml(result.title || 'No Title')}</a>
        </div>
        <div class="result-meta">
          ${result.source ? `${escapeHtml(result.source)} • ` : ''}${result.date_str || 'No date'}
        </div>
        ${result.summary ? `<div class="result-summary">${escapeHtml(result.summary.substring(0, 250))}${result.summary.length > 250 ? '...' : ''}</div>` : ''}
      </div>`
    ).join(''); 
  } 
  
  resultsSection.style.display = 'block'; 
  resultsSection.scrollIntoView({ behavior: 'smooth' }); 
}

function escapeHtml(text) { 
  const div = document.createElement('div'); 
  div.textContent = text; 
  return div.innerHTML; 
}

// Event listeners
window.addEventListener('DOMContentLoaded', () => { 
  updateConnectionStatus(); 
  setTimeout(showConnectionModal, 500); 
  
  document.getElementById('keywords').addEventListener('keydown', (e) => { 
    if (e.key === 'Enter' && e.ctrlKey) { 
      e.preventDefault(); 
      searchFeeds(); 
    } 
  }); 
  
  document.getElementById('newFeedUrl').addEventListener('keydown', (e) => { 
    if (e.key === 'Enter') { 
      e.preventDefault(); 
      addFeed(); 
    } 
  }); 
  
  document.getElementById('apiUrlInput').addEventListener('keydown', (e) => { 
    if (e.key === 'Enter') { 
      e.preventDefault(); 
      connectToAPI(); 
    } 
  }); 
  
  window.addEventListener('click', (e) => { 
    if (e.target.classList.contains('modal')) { 
      if (e.target.id === 'connectionModal') hideConnectionModal(); 
      if (e.target.id === 'confirmModal') hideConfirmModal(); 
    } 
  }); 
});
</script>
</body>
</html>